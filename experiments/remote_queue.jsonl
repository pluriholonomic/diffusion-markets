# Queue - Full 20K Evaluation
# Updated 2025-12-31

# === PRIORITY: Full 20K Eval of RLCR Fixed ===
{"cmd": ".venv/bin/python -m forecastbench pm_eval --dataset-path polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --run-name eval_rlcr_fixed_20k --max-examples 20000 --text-cols question,description --bins 20 --transaction-cost 0.02 --B 1.0 --trading-mode sign --llm-model runs/grpo/20251231_002357_rlcr_fixed_v1/best --L 1 --K 3 --seed 0 --llm-device cuda --llm-dtype bfloat16 --llm-device-map auto --llm-max-new-tokens 128", "gpu": "0", "id": "eval_rlcr_fixed_20k"}

# === Full 20K Eval of AR Baseline ===
{"cmd": ".venv/bin/python -m forecastbench pm_eval --dataset-path polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --run-name eval_ar_baseline_20k --max-examples 20000 --text-cols question,description --bins 20 --transaction-cost 0.02 --B 1.0 --trading-mode sign --llm-model Qwen/Qwen3-14B --L 1 --K 3 --seed 0 --llm-device cuda --llm-dtype bfloat16 --llm-device-map auto --llm-max-new-tokens 128", "gpu": "1", "id": "eval_ar_baseline_20k"}

# === Train RLCR with higher gamma (after current evals) ===
{"cmd": ".venv/bin/python -m forecastbench grpo_train --data-path polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --run-name rlcr_fixed_gamma1 --steps 200 --batch-size 4 --K 4 --lr 2e-6 --kl-coef 0.05 --reward-mode rlcr --rlcr-alpha 1.0 --rlcr-beta 1.0 --rlcr-gamma 1.0 --rlcr-use-groups --model Qwen/Qwen3-14B --seed 0", "gpu": "0", "id": "rlcr_fixed_gamma1", "ready_if": "eval_rlcr_fixed_20k"}

# === RLCR C_t Approximation Error Analysis ===
{"cmd": ".venv/bin/python scripts/analyze_rlcr_ct_error.py --model runs/ar_rlcr_20k_longrun/20251230_005945_ar_rlcr_20k_longrun/best --data polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --max-examples 1000 --K 3 --output runs/rlcr_ct_analysis_longrun.json", "gpu": "any", "id": "rlcr_ct_analysis_longrun"}

# === Also test the new fixed RLCR model (higher gamma) ===
{"cmd": ".venv/bin/python scripts/analyze_rlcr_ct_error.py --model runs/grpo/20251231_002357_rlcr_fixed_v1/best --data polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --max-examples 1000 --K 3 --output runs/rlcr_ct_analysis_fixed_v1.json", "gpu": "any", "id": "rlcr_ct_analysis_fixed_v1"}
{"cmd": ".venv/bin/python -m forecastbench pm_hybrid_train   --dataset-path /root/polymarket_data/derived/gamma_yesno_ready.parquet   --run-name pm_hybrid_train_seed102   --max-rows 1500   --text-cols question,description   --train-frac 0.8   --seed 102   --ar-model Qwen/Qwen3-14B   --ar-K 5   --ar-max-new-tokens 256   --ar-temperature 0.7   --ar-device cuda   --ar-device-map auto   --embed-model Qwen/Qwen3-14B   --embed-device cuda   --embed-dtype bfloat16   --embed-device-map auto   --embed-batch-size 4   --embed-max-length 512   --diff-hidden-dim 256   --diff-depth 4   --diff-T 50   --diff-train-steps 2000   --diff-batch-size 256   --diff-lr 1e-4   --diff-samples 16   --bins 20", "gpu": "0", "id": "pm_hybrid_train_seed102"}

# === Test C_t Modes ===
{"cmd": ".venv/bin/python scripts/test_ct_modes.py --max-rows 100 --rlcr-model runs/ar_rlcr_20k_highgamma/20251229_123316_ar_rlcr_20k_highgamma/best --bundle runs/proper_diffusion_20251228_231929 --skip-ar-diffusion 2>&1 | tee runs/ct_mode_test_results.txt", "gpu": "any", "id": "test_ct_modes_v1"}

# === Test C_t Modes ===
{"cmd": ".venv/bin/python scripts/test_ct_modes.py --data polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --max-rows 100 --skip-legacy --rlcr-model runs/ar_rlcr_20k_longrun/20251230_005945_ar_rlcr_20k_longrun/best --bundle runs/20251231_050457_pm_difftrain_large_seed101", "gpu": "any", "id": "test_ct_modes_v1"}

# === Full Model Comparison Backtest (after 20K evals complete) ===
{"cmd": ".venv/bin/python scripts/compare_all_models_backtest.py --data polymarket_backups/pm_suite_derived/gamma_yesno_ready_20k.parquet --rlcr-preds runs/*/eval_rlcr_fixed_20k/predictions.parquet --ar-preds runs/*/eval_ar_baseline_20k/predictions.parquet --n-bootstrap 2000 --output runs/model_comparison_20k.json", "gpu": "0", "id": "model_comparison_20k", "ready_if": "test -f runs/*/eval_rlcr_fixed_20k/predictions.parquet && test -f runs/*/eval_ar_baseline_20k/predictions.parquet"}
{"cmd": ".venv/bin/python -m forecastbench pm_hybrid_train   --dataset-path /root/polymarket_data/derived/gamma_yesno_ready.parquet   --run-name pm_hybrid_train_gpu1_seed103   --max-rows 2000   --text-cols question,description   --train-frac 0.8   --seed 103   --ar-model Qwen/Qwen3-14B   --ar-K 3   --ar-max-new-tokens 128   --ar-temperature 0.7   --ar-device cuda   --ar-device-map auto   --embed-model Qwen/Qwen3-14B   --embed-device cuda   --embed-dtype bfloat16   --embed-device-map auto   --embed-batch-size 8   --embed-max-length 256   --diff-hidden-dim 512   --diff-depth 6   --diff-T 100   --diff-train-steps 5000   --diff-batch-size 512   --diff-lr 5e-5   --diff-samples 32   --bins 20", "gpu": "1", "id": "pm_hybrid_train_gpu1_seed103"}
{"cmd": ".venv/bin/python -m forecastbench pm_difftrain   --dataset-path /root/polymarket_data/derived/gamma_yesno_ready.parquet   --run-name pm_difftrain_gpu1_seed104   --max-rows 3000   --text-cols question,description   --pred-col pred_prob   --train-frac 0.8   --seed 104   --bins 20   --embed-model Qwen/Qwen3-14B   --embed-device cuda   --embed-dtype bfloat16   --embed-device-map auto   --embed-batch-size 4   --device cuda   --train-steps 8000   --batch-size 256   --lr 1e-4   --T 100   --hidden-dim 512   --depth 6   --sample-steps 50   --mc 32   --agg mean   --log-every 200", "gpu": "1", "id": "pm_difftrain_gpu1_seed104"}
{"cmd": "cd /root/diffusion-markets/experiments && PYTHONPATH=src .venv/bin/python scripts/optimize_and_rank_clustering.py --synthetic --n-markets 150 --n-days 600 --n-configs 25 --output-dir runs/clustering_optimization --seed 42", "gpu": "any", "id": "clustering_optimization_v1", "log": "remote_logs/clustering_optimization_v1.log"}
{"cmd": "cd /root/diffusion-markets/experiments && PYTHONPATH=src .venv/bin/python scripts/optimize_and_rank_clustering.py --synthetic --n-markets 200 --n-days 800 --n-configs 40 --output-dir runs/clustering_optimization_full --seed 123", "gpu": "any", "id": "clustering_optimization_full", "log": "remote_logs/clustering_optimization_full.log"}
